---
id: consensus_zh
title: 共识
---

## 什么是共识？

共识是去中心化网络中的参与者之间达成一致的状态。这意味着网络中的节点认同区块链的历史以及当前状态。状态代表着数据，例如每个用户所拥有的 CKBytes 数量以及数字资产类型。

Nervos 网络中拥有数千台节点计算机以及数百万笔不断在网络中流动的交易。网络中的计算机必须就哪些为有效交易以及其发生的顺序达成一致。这十分有挑战性，因为这些节点分布在全球各地，网络传输并不是即时的，同时也非完全可靠。

节点之间传递消息，共享已生成的区块以及交易信息。这些消息可能没有按照正确顺序到达，可能很晚到达，可能根本无法到达。同时也无法保证所有节点都正常运行或保持诚实。

价值数十亿美元利害攸关，挑战巨大，稳健可靠的解决方案至关重要。

## NC-Max

像 Nervos 这样雄心勃勃的项目需要一个零妥协的共识方案。经过多种可选方案的对比以及深思熟虑后，我们觉得工作量证明机制（PoW）仍是最佳解决方案。

权益证明机制（PoS）是当前市面上最流行的共识机制之一。其最大的优势是省电低碳环保。但是，与 PoS 相比，PoW 仍具有一些优势：

* PoW 挖矿受技术，能源生产和监管等外部因素变化的影响。这意味着必须持续进行再投资才能保持竞争优势，从而使长期垄断变得困难。
* PoW 并未给系统的早期参与者带来巨大的优势。在 PoS 中，奖励是完全确定性地获得的，这意味着后来者无法与早期参与者竞争。
* PoW 更简单，前提假设更少，这意味着潜在的安全漏洞大大降低。

比特币的中本聪共识 PoW 算法在过去十多年中成功抵御了无数次攻击。该技术已广为人知且已被证明经得住时间的考验。Nervos 的 NC-MAX 共识算法基于中本聪共识，消除了区块传播瓶颈、增加了吞吐量并减少了自私挖矿攻击。

## 优化区块传播

当一笔交易被广播给网络中的所有节点时，它将一直处于队列中，直到被包含在未来的区块中。当交易广播未完全成功时，便会出现性能瓶颈。一些节点可能接收到了交易，但部分节点没有。如果广播出去的区块中的部分交易有部分节点没有接收到，那么这些节点就需要在区块被正确验证之前，花时间同步这些丢失的交易，这就造成了网络的延迟。

这个瓶颈限制了区块链的性能，因为随着出块时间的缩短，其造成的影响就越大。这也会导致自私挖矿攻击，因为矿工可以故意造成网络延迟，从而让自己比其他矿工多点优势，好获得更多的挖矿奖励。

NC-MAX 解决此问题的方法是，通过将交易确认过程分为两步：交易提出（propose）和交易确认（commit）。一笔交易首先会在网络中提出，直到过了数个区块后，该交易才会被确认。这为交易广播提供了更多时间，也不会减慢区块传播。只要交易被提出并且完全广播给所有节点，便可以提交交易。这消除了交易传播延迟导致的区块传播延迟，消除了性能瓶颈以及自私挖矿攻击。

## 增加区块吞吐量

更短的出块间隔意味着更频繁的出块，从而实现更快的交易确认以及网络吞吐量。缺点就是互联网连接阻塞对区块链网络正确同步的能力有很大影响。新区块有时候在网络尚未完全同步时就创建了，即孤块。这将导致网络安全算力的分流。出现部分孤块是在所难免的，但如果在短时间内出现大量孤块，则网络算力的付出为无用功的同时，也不利于网络安全。

NC-MAX 通过根据网络性能自动调节区块间隔来改善这点。共识协议会追踪度量一定时间范围内的孤块数量，在保持预期孤块率的同时，网络会通过调节区块间隔以最大化吞吐量。在无需牺牲安全性的前提下，显著缩短区块时间。

## 减少自私挖矿

自私挖矿是矿工在网络贡献较少算力时却秘密获得大部分挖矿奖励的行为。这是值得唾弃的行为，因为这样不仅削弱了整体网络的安全，也会造成不规律的出块时间以及阻塞问题。

NC-MAX 通过考虑外部和内部因素，提供了最精确的网络算力度量方式，在调节难度时将叔块考虑在内，让所有自私挖矿无利可图。

## Eaglesong

比特币的中本聪共识使用的是著名的 SHA256 哈希算法。目前全球主流的挖矿基础设施都是基于该算法。

基于 SHA256 的新项目也会受益于当前的这种硬件基础设施。但缺点是，现在的这些大规模硬件基础设施可以被恶意用于新项目的早期阶段进行算力攻击。能拥有网络生态专用的挖矿硬件设备总体上是有好处的，因此这可以大大增强网络的抗攻击性。处于这方面的考虑，我们为 Nervos 专门创造了一个新的加密哈希函数 Eaglesong。

Eaglesong 成功地将新颖性、简单性与安全性融会贯通，且易于在软件与硬件中实现。这项进步让 Nervos 在区块链安全方面更具优势，同时具备完整的硬件主权。

## 扩展阅读

* 有关共识主题的更多信息，请参阅[共识协议RFC](https://github.com/nervosnetwork/rfcs/blob/master/rfcs/0020-ckb-consensus-protocol/0020-ckb-consensus-protocol.md)。
* 有关 Eaglesong 算法的更多信息，请参见[Eaglesong RFC](https://github.com/nervosnetwork/rfcs/blob/master/rfcs/0010-eaglesong/0010-eaglesong.md)。

